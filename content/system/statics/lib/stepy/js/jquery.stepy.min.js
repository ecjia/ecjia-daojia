/*!
 * jQuery Stepy - A Wizard Plugin
 *
 * Licensed under The MIT License
 *
 * @version        1.1.0
 * @author         Washington Botelho
 * @documentation  wbotelhos.com/stepy
 *
 */

;(function(e){var f={init:function(b){return this.each(function(){var d=e.extend({},e.fn.stepy.defaults,b),a=e(this).data("options",d),c=a.attr("id");if(void 0===c||""==c)c="stepy-"+e("."+a.attr("class")).index(this),a.attr("id",c);var h=e("<ul/>",{id:c+"-titles","class":"stepy-titles clearfix"});d.titleTarget?e(d.titleTarget).html(h):h.insertBefore(a);d.validate&&(jQuery.validator.setDefaults({ignore:d.ignore}),a.append('<div class="stepy-error"/>'));var g=a.children("fieldset"),j=void 0,l=void 0, o="",k="";g.each(function(i){j=e(this);j.addClass("step").attr("id",c+"-step-"+i).append('<p id="'+c+"-buttons-"+i+'" class="'+c+'-buttons"/>');l=j.children("legend");d.legend||l.hide();o="";d.description&&(l.length?o="<span>"+l.html()+"</span>":e.error(c+": the legend element of the step "+(i+1)+" is required to set the description!"));k=j.attr("title");k=k!=""?"<div>"+k+"</div>":"--";h.append('<li id="'+c+"-title-"+i+'">'+k+o+"</li>");j.attr("title","");if(i==0)g.length>1&&f.createNextButton.call(a, i);else{f.createBackButton.call(a,i);j.hide();i<g.length-1&&f.createNextButton.call(a,i)}});var m=h.children();m.first().addClass("current-step");var n=a.children(".finish");if(d.finishButton)if(n.length){var q=a.is("form"),p=void 0;d.finish&&q&&(p=a.attr("onsubmit"),a.attr("onsubmit","return false;"));n.click(function(c){if(d.finish&&!f.execute.call(a,d.finish,g.length-1))c.preventDefault();else if(q){p?a.attr("onsubmit",p):a.removeAttr("onsubmit");n.attr("type")!="submit"&&(!d.validate||f.validate.call(a, g.length-1))&&a.submit()}});n.appendTo(a.find("p:last"))}else e.error(c+': element with class name "finish" missing!');d.titleClick?m.click(function(){var c=m.filter(".current-step").attr("id").split("-"),c=parseInt(c[c.length-1],10),b=e(this).index();if(b>c){if(d.next&&!f.execute.call(a,d.next,b))return false}else if(b<c&&d.back&&!f.execute.call(a,d.back,b))return false;b!=c&&f.step.call(a,b+1)}):m.css("cursor","default");g.delegate('input[type="text"], input[type="password"]',"keypress",function(a){if((a.keyCode? a.keyCode:a.which)==13){a.preventDefault();a=e(this).parent().children("."+c+"-buttons");if(a.length){var b=a.children(".button-next");if(b.length)b.click();else{a=a.children(".finish");a.length&&a.click()}}}});g.first().find(":input:visible:enabled").first().select().focus()})},createBackButton:function(b){var d=this,a=this.attr("id"),c=this.data("options");e("<a/>",{id:a+"-back-"+b,href:"javascript:void(0);","class":"btn button-back",html:c.backLabel}).click(function(){(!c.back||f.execute.call(d, c.back,b-1))&&f.step.call(d,b-1+1)}).appendTo(e("#"+a+"-buttons-"+b))},createNextButton:function(b){var d=this,a=this.attr("id"),c=this.data("options");e("<a/>",{id:a+"-next-"+b,href:"javascript:void(0);","class":"btn btn-inverse button-next",html:c.nextLabel}).bind('click.next',function(){(!c.next||f.execute.call(d,c.next,b+1))&&f.step.call(d,b+1+1)}).appendTo(e("#"+a+"-buttons-"+b))},execute:function(b,d){var a=b.call(this,d+1);return a||void 0===a},step:function(b){b--;var d=this.children("fieldset");b>d.length- 1&&(b=d.length-1);var a=this.data("options");max=b;if(a.validate)for(var c=!0,h=0;h<b;h++)if(c&=f.validate.call(this,h),a.block&&!c){max=h;break}d.hide().eq(max).show();e("#"+this.attr("id")+"-titles").children().removeClass("current-step").eq(max).addClass("current-step");this.is("form")&&(c=void 0,c=max==b?d.eq(max).find(":input:enabled:visible"):d.eq(max).find(".error").select().focus(),c.first().select().focus());a.select&&a.select.call(this,max+1);return this},validate:function(b){if(!this.is("form"))return!0; var d=this.children("fieldset").eq(b),a=!0,c=e("#"+this.attr("id")+"-titles").children().eq(b),f=this.data("options"),g=this.validate();e(d.find(":input:enabled").get().reverse()).each(function(){var b=g.element(e(this));void 0===b&&(b=!0);(a&=b)?f.errorImage&&c.removeClass("error-image"):(f.errorImage&&c.addClass("error-image"),g.focusInvalid())});return a}};e.fn.stepy=function(b){if(f[b])return f[b].apply(this,Array.prototype.slice.call(arguments,1));if("object"===typeof b||!b)return f.init.apply(this, arguments);e.error("Method "+b+" does not exist!")};e.fn.stepy.defaults={back:void 0,backLabel:"&lt; Back",block:!1,description:!0,errorImage:!1,finish:void 0,finishButton:!0,legend:!0,ignore:"",next:void 0,nextLabel:"Next &gt;",titleClick:!1,titleTarget:void 0,validate:!1,select:void 0}})(jQuery);