(function(ecjia,$){ecjia.ui={editor_info:"",init:function(){if($(".admin-editor-container").length>0){$(".admin-editor-container").css({clear:"none"})}ecjia.ui.check_pjax();ecjia.ui.set_sortable()},alert:function(msg){return smoke.alert(msg,{ok:admin_lang.ok})},confirm:function(msg,callback){return smoke.confirm(msg,callback,{ok:admin_lang.ok,cancel:admin_lang.cancel})},check_pjax:function(){if(!!(window.history&&history.pushState)){}else{console.log("您使用的浏览器并不能很好的支持我们的效果，请更换浏览器访问或开启浏览器history.pushState扩展。")}},set_sortable:function(){if(jQuery.isFunction(jQuery.fn.sortable)){$(".move-mod").not(".nomove").sortable({connectWith:".move-mod",distance:5,handle:".move-mod-head",placeholder:"ui-sortable-placeholder",items:".move-mod-group:not(.not-move)",activate:function(event,ui){$(".move-mod").addClass("sort_ph")},stop:function(event,ui){$(".move-mod").removeClass("sort_ph")},sort:function(){$(this).removeClass("ui-state-default")},update:function(e,ui){var name=ui.item.find(".move-mod-head").attr("data-sortname");if(name){ecjia.admin.save_sortIndex(name)}}});$(".move-mod-head").disableSelection()}},ajax_remove:function(options){var defaults={url:false,id:"",msg:admin_lang.confirm_del,obj:"",};var options=$.extend({},defaults,options);if(!options.url){ecjia.ui.alert(admin_lang.error);return false}smoke.confirm(options.msg,function(e){if(e){$.get(options.url,options.id,function(data){ecjia.pjax(window.location.href,function(){ecjia.admin.showmessage(data)})},"json")}},{ok:admin_lang.ok,cancel:admin_lang.cancel})},batch:function(options){var defaults={url:false,msg:admin_lang.confirm,noSelectMsg:admin_lang.please_select,name:"checkboxes",id:[],};var options=$.extend({},defaults,options);if(!options.url||options.id.length==0){return console.log(admin_lang.batch_error)}var ajaxinfo="{"+options.name+":'"+options.id+"'}";ajaxinfo=eval("("+ajaxinfo+")");smoke.confirm(options.msg,function(e){if(e){$.ajax({type:"POST",url:options.url,data:ajaxinfo,dataType:"json",success:function(data){ecjia.admin.showmessage(data)}})}},{ok:admin_lang.ok,cancel:admin_lang.cancel})},sort:function(options){ecjia.pjax(options.url+"&sort_by="+options.sort_by+"&sort_order="+options.sort_order,function(){$('[data-sortby="'+options.sort_by+'"]').addClass(options.sortclass)})},clone_obj:function(options){if(!options.parentobj){return console.log(admin_lang.batch_error)}var tmpObj=options.parentobj.clone();tmpObj.find('[data-toggle="clone-obj"]').attr("data-toggle","remove-obj").on("click",function(){tmpObj.remove()}).find("i").attr("class","fontello-icon-cancel ecjiafc-red");(options.before=="before")?options.parentobj.before(tmpObj):options.parentobj.after(tmpObj);tmpObj.find(".chzn-container").remove();tmpObj.find("select").removeClass("chosen_hide").removeClass("chzn-done").attr({"id":""}).chosen();options.parentobj.find("input").not(":hidden").val("")},select_all:function(options){var defaults={thisobj:false,children:false,};var options=$.extend({},defaults,options);if(!options.thisobj){console.log(admin_lang.parameter_error);return false}if(!options.children){options.children='input[type="checkbox"]'}options.allobj=$(options.children);if(!options.thisobj.prop("checked")){options.allobj.prop("checked",false)}else{options.allobj.prop("checked",true)}if($.uniform.update){$.uniform.update(options.allobj)}},re_select_all:function(){$('input[data-toggle="selectall"]').each(function(i){var parents=$(this).eq(i).attr("data-toggle")?$(this).eq(i):$(this).eq(i).prevObject,children=parents.attr("data-children"),$children=$(children);if(children&&$children.length){$children.filter(":checked").length==$children.length?parents.prop("checked",true):parents.prop("checked",false)}$.uniform.update&&parents&&$.uniform.update(parents)});if($(".checkbox").filter(":checked").length==$(".checkbox").length){$('input[name="checkall"]').prop("checked",true)}else{$('input[name="checkall"]').prop("checked",false)}$.uniform.update&&$.uniform.update($('input[name="checkall"]'))},removefile:function(options){var defaults={url:false,id:"",msg:admin_lang.confirm_delete_file,obj:""};var options=$.extend({},defaults,options);if($(options.obj).attr("data-removefile")!="true"){$(options.obj).parent().removeClass("fileupload-exists");$(options.obj).parent().addClass("fileupload-new");$(options.obj).parent().children(".fileupload-preview").children().remove();return false}if(!options.url){ecjia.ui.alert(admin_lang.error);return false}smoke.confirm(options.msg,function(e){if(e){$.get(options.url,options.id,function(data){if(data.state=="success"){$(options.obj).parent().children("div:first-child").find("img").attr("src","");$(options.obj).parent().children("div:first-child").find("a").attr("href","");$(options.obj).parent().removeClass("fileupload-exists");$(options.obj).parent().addClass("fileupload-new");$(options.obj).removeAttr("data-removefile");ecjia.admin.showmessage(data)}},"json")}},{ok:admin_lang.ok,cancel:admin_lang.cancel})},toggleState:function(option){$.ajax({url:option.url,data:{id:option.id,val:option.val},type:option.type,dataType:"json",success:function(data){if(data.state=="error"){ecjia.admin.showmessage(data)}else{data.content?option.obj.removeClass("fontello-icon-cancel").addClass("fontello-icon-ok"):option.obj.removeClass("fontello-icon-ok").addClass("fontello-icon-cancel");data.pjaxurl?ecjia.admin.showmessage(data):ecjia.admin.showmessage(admin_lang.status_success)}}})},toggleStateNew:function(option){$.ajax({url:option.url,data:{id:option.id,val:option.val},type:option.type,dataType:"json",success:function(data){if(data.state=="error"){ecjia.admin.showmessage(data)}else{data.content?option.obj.removeClass("toggleOff").addClass("toggleOn"):option.obj.removeClass("toggleOn").addClass("toggleOff");data.pjaxurl?ecjia.admin.showmessage(data):ecjia.admin.showmessage(admin_lang.status_success)}}})},};$(document).on("click",'[data-toggle="ajaxremove"]',function(e){var $this=$(this);var url=$this.attr("data-href")||$this.attr("href");var id=$this.attr("data-id");var msg=$this.attr("data-msg");var $obj=$this.attr("data-removeClass")?$("."+$this.attr("data-removeClass")):$this.closest("tr");var option={url:url,id:id,msg:msg,obj:$obj};e.preventDefault();ecjia.ui.ajax_remove(option)});$(document).on("click",'[data-toggle="ecjiabatch"]',function(e){var $this=$(this);e.preventDefault();var $id=$($this.attr("data-idClass"))||$(".checkbox:checked");var id=[];$id.each(function(){id.push($(this).val())});var name=$this.attr("data-name")||"checkboxes";var url=$this.attr("data-url");var msg=$this.attr("data-msg")||admin_lang.confirm;var noSelectMsg=$this.attr("data-noSelectMsg")||admin_lang.please_select;var option={id:id,url:url,msg:msg,name:name};id.length==0?ecjia.ui.alert(noSelectMsg):ecjia.ui.batch(option)});$(document).on("click",'[data-toggle="sortby"]',function(e){e.preventDefault();var $this=$(this),url=$this.parent("tr").attr("data-sorthref"),sort_by=$this.attr("data-sortby"),sort_order=$this.hasClass("sorting-asc")?"desc":"asc",sortclass=$this.hasClass("sorting-asc")?"sorting-desc":"sorting-asc",option={url:url,sort_by:sort_by,sort_order:sort_order,thisobj:$this,sortclass:sortclass};(!option.url||!option.sort_by||!option.sort_order)&&console.log(admin_lang.missing_parameters);ecjia.ui.sort(option)});$(document).on("click",'[data-toggle="sortbyDesc"]',function(e){e.preventDefault();var $this=$(this),url=$this.parent("tr").attr("data-sorthref"),sort_by=$this.attr("data-sortby"),sort_order="desc",sortclass="sorting-desc",option={url:url,sort_by:sort_by,sort_order:sort_order,thisobj:$this,sortclass:sortclass};(!option.url||!option.sort_by||!option.sort_order)&&console.log(admin_lang.missing_parameters);ecjia.ui.sort(option)});$(document).on("click",'[data-toggle="clone-obj"]',function(e){e.preventDefault();var $this=$(this),$parentobj=$this.parents($this.attr("data-parent")),before=$this.attr("data-before")||"after",option={parentobj:$parentobj,before:before};console.log(before);!$parentobj?console.log(admin_lang.clone):ecjia.ui.clone_obj(option)});$(document).on("click",'[data-toggle="remove-obj"]',function(e){e.preventDefault();var $this=$(this),$parentobj=$this.parents($this.attr("data-parent"));$parentobj.remove()});$(document).on("click",'[data-trigger="toggleState"]',function(e){var $this=$(this);var url=$this.attr("data-url");var id=$this.attr("data-id");var val=$this.hasClass("fontello-icon-cancel")?1:0;var type=$this.attr("data-type")?$this.attr("data-type"):"POST";var option={obj:$this,url:url,id:id,val:val,type:type};e.preventDefault();ecjia.ui.toggleState(option)});$(document).on("click",'[data-trigger="toggleStateNew"]',function(e){var $this=$(this);var url=$this.attr("data-url");var id=$this.attr("data-id");var val=$this.hasClass("toggleOff")?1:0;var type=$this.attr("data-type")?$this.attr("data-type"):"POST";var option={obj:$this,url:url,id:id,val:val,type:type};e.preventDefault();ecjia.ui.toggleStateNew(option)});$(document).on("click",'[data-toggle="removefile"]',function(e){var $this=$(this);var url=$this.attr("data-href")||$this.attr("href");var msg=$this.attr("data-msg");var option={url:url,msg:msg,obj:$this};e.preventDefault();ecjia.ui.removefile(option)});$(document).on("change",'input[type="checkbox"]',function(){var $this=$(this);if($this.attr("data-toggle")=="selectall"){var children=$this.attr("data-children");var option={thisobj:$this,children:children};ecjia.ui.select_all(option)}ecjia.ui.re_select_all()});$(ecjia.ui.init).on("pjax.end",".main_content",ecjia.ui.init)})(ecjia,jQuery);